/*! ngapi 2013-10-16 */
"use strict";angular.module("ngapi",[]).factory("apiroutes",["apiurl","$http",function(a,b){if(a)return a;var c={};return angular.forEach(a,function(a,d){var e=/http:/;b.get(a).success(function(b){c[d]=b,e.test(a)&&(c[d].url="http://"+a.replace("http://","").split("/")[0])})}),c}]).directive("ngApi",["apiroutes","apicrypto","apicnonce","apivalidate","$http",function(a,b,c,d,e){var f={validate:{email:function(a){var b=/.+\@.+\..+/;return b.test(a)},number:function(a){var b=/[0-9]/g;return b.test(a)},string:function(a){var b=/\w+/;return a.match(b)[0]==a?!0:!1},nospace:function(a){var b=/\s/;return b.test(a)?!1:!0}}};return{replace:!0,restrict:"AE",link:function(g,h,i){var j=g,k=i.ngApi;k=k.replace(" ","");var l=/(\(.*\))(\(.*\))/,m=k.match(l),n={init:function(a){return a.split(/^\(/)[1].split(/\)$/)[0].split("||")},specColon:function(a){var b=/:/;return b.test(a)?a.split(/:/):!1}};h.bind("click",function(){if(m.length<=3){var g=n.init(m[1]),h=n.init(m[2]),k=/:/;angular.forEach(g,function(a){if(f.validate[n.specColon(a)[1]]){if(!f.validate[n.specColon(a)[1]](j[n.specColon(a)[0]]))return console.log("驗證不通過"),!1}else if(!d[n.specColon(a)[1]](j[n.specColon(a)[0]]))return console.log("驗證不通過"),!1});var l=n.specColon(h[0])[0]||a[h[0].split(".")[0]][h[0].replace(h[0].split(".")[0]+".","")].methods[0];l=l.toLowerCase();var o=i.apiSuccess,p=i.apiError;switch(e.defaults.useXDomain=!0,l){case"get":k.test(h)?e.get(a+n.specColon(h[0])[1]).success(function(a){return j[o]?j[o](a):void 0}).error(function(a){return j[p]?j[p](a):void 0}):e.get(a[h[0].split(".")[0]].url+a[h[0].split(".")[0]][h[0].replace(h[0].split(".")[0]+".","")].path).success(function(a){return j[o]?j[o](a):void 0}).error(function(a){return j[p]?j[p](a):void 0});break;case"post":var q=apiurl+n.specColon(h[0])[1];e.post(q,{something:!0,color:"blue",one:1}).success(function(a){return j[o]?j[o](a):void 0});break;case"restfullogin":var r=n.specColon(h[0])[1],s=h[1];e.get(a+r).success(function(d){var f=b(j.password),g=b([f,d.data.nonce,c].sort().join(""));e.post(a+s,{login:j.user,cnonce:c,hash:g,key:d.data.key}).success(function(a){return console.log(a),j[o]?j[o](a):void 0})})}}else console.log("Your youmeb value is wrong! must be=>(data)(method:apiurl)")})}}}]);