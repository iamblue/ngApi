/*! ngapi 2013-12-05 */
"use strict";angular.module("ngapi",[]).factory("apiroutes",["apiurl","$http",function(a,b){if("string"==typeof a)return a;var c={};return angular.forEach(a,function(a,d){var e=/http:/;b.get(a).success(function(b){c[d]=b,e.test(a)&&(c[d].url="http://"+a.replace("http://","").split("/")[0])})}),c}]).service("apitools",function(){this.validate={email:function(a){var b=/.+\@.+\..+/;return b.test(a)},number:function(a){var b=/[0-9]/g;return b.test(a)},string:function(a){var b=/\w+/;return a.match(b)[0]==a?!0:!1},nospace:function(a){var b=/\s/g;return!b.test(a)}},this.reg={init:function(a){return a.split(/^\(/)[1].split(/\)$/)[0].split("||")},specColon:function(a){var b=/:/;return b.test(a)?a.split(/:/):!1}}}).directive("ngApi",["apiroutes","apicrypto","apicnonce","apitools","apivalidate","$http",function(a,b,c,d,e,f){return{replace:!0,restrict:"AE",link:function(g,h,i){var j=g,k=i.ngApi;k=k.replace(" ","");var l=/(\(.*\))(\(.*\))/,m=/(^\(\(|^\(\w+\(.*)/,n=k.match(l);h.bind("click",function(){if(l.test(n[1])||n[1].match(m)||n[2].match(m))throw new SyntaxError("Your ng-api value is wrong! must be=>(data)(method:apiurl)");var g=d.reg.init(n[1]),h=d.reg.init(n[2]);if(n[3])var k=d.reg.init(n[3]);var o=/:/,p=d.reg.specColon,q=[];angular.forEach(g,function(a){d.validate[p(a)[1]]?d.validate[p(a)[1]](j[p(a)[0]])||(n[3]&&j[k](p(a)[0]),q.push(!1)):e[p(a)[1]](j[p(a)[0]])||(n[3]&&j[k](p(a)[0]),q.push(!1))});var r=i.apiSuccess,s=i.apiError,t=function(){var e=d.reg.specColon(h[0])[0]||a[h[0].split(".")[0]][h[0].replace(h[0].split(".")[0]+".","")].methods[0];switch(e=e.toLowerCase(),f.defaults.useXDomain=!0,e){case"get":if(o.test(h)){var i={};angular.forEach(g,function(a){i[a.split(":")[0]]=j[a.split(":")[0]]}),f.get(a+d.reg.specColon(h[0])[1],{params:i}).success(function(a){return j[r]?j[r](a):void 0}).error(function(a){return j[s]?j[s](a):void 0})}else f.get(a[h[0].split(".")[0]].url+a[h[0].split(".")[0]][h[0].replace(h[0].split(".")[0]+".","")].path).success(function(a){return j[r]?j[r](a):void 0}).error(function(a){return j[s]?j[s](a):void 0});break;case"post":var k,i;if("string"==typeof a)k=a+d.reg.specColon(h[0])[1];else{var l,m,n;l=h[0].split("."),m=[],n="";for(var p=1;p<=l.length-1;p++)m.push(l[p]);n=m.join().replace(/\,/g,"."),k=a.routes.url+a[l[0]][n].path}i={},angular.forEach(g,function(a){i[a.split(":")[0]]=j[a.split(":")[0]]}),f.post(k,i).success(function(a){return j[r]?j[r](a):void 0});break;case"restfullogin":var q=d.reg.specColon(h[0])[1],t=h[1];f.get(a+q).success(function(d){var e=b(j.password),g=b([e,d.data.nonce,c].sort().join(""));f.post(a+t,{login:j.user,cnonce:c,hash:g,key:d.data.key}).success(function(a){return j[r]?j[r](a):void 0})})}};return 0==q.length?t():void 0})}}}]);