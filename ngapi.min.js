/*! ngapi 2013-10-17 */
"use strict";angular.module("ngapi",[]).factory("apiroutes",["apiurl","$http",function(a,b){if(a)return a;var c={};return angular.forEach(a,function(a,d){var e=/http:/;b.get(a).success(function(b){c[d]=b,e.test(a)&&(c[d].url="http://"+a.replace("http://","").split("/")[0])})}),c}]).service("apitools",function(){this.validate={email:function(a){var b=/.+\@.+\..+/;return b.test(a)},number:function(a){var b=/[0-9]/g;return b.test(a)},string:function(a){var b=/\w+/;return a.match(b)[0]==a?!0:!1},nospace:function(a){var b=/\s/;return b.test(a)?!1:!0}},this.reg={init:function(a){return a.split(/^\(/)[1].split(/\)$/)[0].split("||")},specColon:function(a){var b=/:/;return b.test(a)?a.split(/:/):!1}}}).directive("ngApi",["apiroutes","apicrypto","apicnonce","apitools","apivalidate","$http",function(a,b,c,d,e,f){return{replace:!0,restrict:"AE",link:function(g,h,i){var j=g,k=i.ngApi;k=k.replace(" ","");var l=/(\(.*\))(\(.*\))/,m=/(^\(\(|^\(\w+\(.*)/,n=k.match(l);h.bind("click",function(){if(l.test(n[1])||n[1].match(m)||n[2].match(m))console.log("Your ng-api value is wrong! must be=>(data)(method:apiurl)");else{var g=d.reg.init(n[1]),h=d.reg.init(n[2]);if(n[3])var k=d.reg.init(n[3]);var o=/:/;angular.forEach(g,function(a){if(d.validate[d.reg.specColon(a)[1]]){if(!d.validate[d.reg.specColon(a)[1]](j[d.reg.specColon(a)[0]]))return n[3]&&j[k](d.reg.specColon(a)[0]),!1}else if(!e[d.reg.specColon(a)[1]](j[d.reg.specColon(a)[0]]))return n[3]&&j[k](d.reg.specColon(a)[0]),!1});var p=d.reg.specColon(h[0])[0]||a[h[0].split(".")[0]][h[0].replace(h[0].split(".")[0]+".","")].methods[0];p=p.toLowerCase();var q=i.apiSuccess,r=i.apiError;switch(f.defaults.useXDomain=!0,p){case"get":if(o.test(h)){var s={};angular.forEach(g,function(a){s[a.split(":")[0]]=j[a.split(":")[0]]}),f.get(a+d.reg.specColon(h[0])[1],{params:s}).success(function(a){return j[q]?j[q](a):void 0}).error(function(a){return j[r]?j[r](a):void 0})}else f.get(a[h[0].split(".")[0]].url+a[h[0].split(".")[0]][h[0].replace(h[0].split(".")[0]+".","")].path).success(function(a){return j[q]?j[q](a):void 0}).error(function(a){return j[r]?j[r](a):void 0});break;case"post":var t=a+d.reg.specColon(h[0])[1],s={};angular.forEach(g,function(a){s[a.split(":")[0]]=j[a.split(":")[0]]}),f.post(t,s).success(function(a){return j[q]?j[q](a):void 0});break;case"restfullogin":var u=d.reg.specColon(h[0])[1],v=h[1];f.get(a+u).success(function(d){var e=b(j.password),g=b([e,d.data.nonce,c].sort().join(""));f.post(a+v,{login:j.user,cnonce:c,hash:g,key:d.data.key}).success(function(a){return console.log(a),j[q]?j[q](a):void 0})})}}})}}}]);