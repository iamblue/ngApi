/*! ngapi 2013-12-05 */
"use strict";angular.module("ngapi",[]).factory("apiroutes",["api","$http",function(a,b){if("string"==typeof a.url)return a.url;if("object"==typeof a.url){var c={};return angular.forEach(a.url,function(a,d){var e=/http:/;b.get(a).success(function(b){c[d]=b,e.test(a)&&(c[d].url="http://"+a.replace("http://","").split("/")[0])})}),c}}]).service("apitools",function(){this.validate={email:function(a){var b=/.+\@.+\..+/;return b.test(a)},number:function(a){var b=/[0-9]/g;return b.test(a)},string:function(a){var b=/\w+/;return a.match(b)[0]==a?!0:!1},nospace:function(a){var b=/\s/g;return!b.test(a)}},this.reg={init:function(a){return a.split(/^\(/)[1].split(/\)$/)[0].split("||")},specColon:function(a){var b=/:/;return b.test(a)?a.split(/:/):!1}}}).directive("ngApi",["apiroutes","apitools","api","$http",function(a,b,c,d){return{replace:!0,restrict:"AE",link:function(e,f,g){console.log(c);var h=c.cnonce||"",i=c.crypto||"",j=c.validate||{},k=e,l=g.ngApi;l=l.replace(" ","");var m=/(\(.*\))(\(.*\))/,n=/(^\(\(|^\(\w+\(.*)/,o=l.match(m);f.bind("click",function(){if(m.test(o[1])||o[1].match(n)||o[2].match(n))throw new SyntaxError("Your ng-api value is wrong! must be=>(data)(method:apiurl)");var c=b.reg.init(o[1]),e=b.reg.init(o[2]);if(o[3])var f=b.reg.init(o[3]);var l=/:/,p=b.reg.specColon,q=[];angular.forEach(c,function(a){b.validate[p(a)[1]]?b.validate[p(a)[1]](k[p(a)[0]])||(o[3]&&k[f](p(a)[0]),q.push(!1)):j[p(a)[1]](k[p(a)[0]])||(o[3]&&k[f](p(a)[0]),q.push(!1))});var r=g.apiSuccess,s=g.apiError,t=function(a,b,c){d[a](b,c).success(function(a,b,c,d){return k[r]?k[r].apply(k[r],[a,b,c,d]):void 0}).error(function(a,b,c,d){return k[s]?k[s].apply(k[s],[a,b,c,d]):void 0})},u=function(){var f=b.reg.specColon(e[0])[0]||a[e[0].split(".")[0]][e[0].replace(e[0].split(".")[0]+".","")].methods[0];switch(f=f.toLowerCase(),d.defaults.useXDomain=!0,f){case"get":if(l.test(e)){var g={};return angular.forEach(c,function(a){g[a.split(":")[0]]=k[a.split(":")[0]]}),t("get",a+b.reg.specColon(e[0])[1],{params:g})}return t("get",a[e[0].split(".")[0]].url+a[e[0].split(".")[0]][e[0].replace(e[0].split(".")[0]+".","")].path,"");case"post":var j,g;if("string"==typeof a)j=a+b.reg.specColon(e[0])[1];else{var m,n,o;m=e[0].split("."),n=[],o="";for(var p=1;p<=m.length-1;p++)n.push(m[p]);o=n.join().replace(/\,/g,"."),j=a.routes.url+a[m[0]][o].path}return g={},angular.forEach(c,function(a){g[a.split(":")[0]]=k[a.split(":")[0]]}),t("post",j,g);case"restfullogin":{var q=b.reg.specColon(e[0])[1];e[1]}d.get(a+q).success(function(a){{var b=i(k.password);i([b,a.data.nonce,h].sort().join(""))}})}};return 0==q.length?u():void 0})}}}]);